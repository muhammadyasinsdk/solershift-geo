<!doctype html>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Geo Bridge</title>
<script>
(function(){
  // parent (آپ کا ESP صفحہ) — اگر آپ 192.168.4.1 بدلتے ہیں تو یہاں بھی بدلیں
  const PARENT = "http://192.168.4.1";
  const post   = data => parent.postMessage(data, PARENT);

  function send(){
    if (!('geolocation' in navigator)){
      post({type:'geo', err:'no_geolocation'});
      return;
    }
    navigator.geolocation.getCurrentPosition(
      p => post({type:'geo', lat:p.coords.latitude, lon:p.coords.longitude, acc:p.coords.accuracy}),
      e => post({type:'geo', err:e.message}),
      { enableHighAccuracy:true, maximumAge:60000, timeout:8000 }
    );
  }

  // اگر ?auto=1 آیا ہو تو فوراً چلائیں (بٹن کلک user-gesture شمار ہوتا ہے)
  const auto = new URLSearchParams(location.search).get('auto') === '1';
  if (auto) send();

  // پھر بھی چاہیں تو parent بعد میں بھی کہہ سکتا ہے
  window.addEventListener('message', e => { if (e.data === 'geo:get') send(); });
})();
</script>
<body style="margin:0;font:14px system-ui">
Getting location…
</body>
